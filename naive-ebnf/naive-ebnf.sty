%%
%% This is file `naive-ebnf.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% naive-ebnf.dtx  (with options: `package')
%% (The MIT License)
%% 
%% Copyright (c) 2023 Yegor Bugayenko
%% 
%% Permission is hereby granted, free of charge, to any person obtaining a copy
%% of this software and associated documentation files (the 'Software'), to deal
%% in the Software without restriction, including without limitation the rights
%% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
%% copies of the Software, and to permit persons to whom the Software is
%% furnished to do so, subject to the following conditions:
%% 
%% The above copyright notice and this permission notice shall be included in all
%% copies or substantial portions of the Software.
%% 
%% THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
%% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
%% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
%% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
%% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
%% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
%% SOFTWARE.



\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{naive-ebnf}
[0000-00-00 0.0.0 EBNF in Plain Text]











\RequirePackage{pgfopts}
\pgfkeys{
  /ebnf/.cd,
  bw/.store in=\ebnf@bw,
  trail/.store in=\ebnf@trail,
}
\ProcessPgfPackageOptions{/ebnf}

\RequirePackage{expl3}

\makeatletter\ifdefined\ebnf@bw\else
  \RequirePackage{xcolor}
\fi
\newcommand\ebnf@color[2]
  {\ifdefined\ebnf@bw#2\else\textcolor{#1}{#2}\fi}
\makeatother

\makeatletter
\newcommand\terminal[1]{{%
  \relax\ifmmode\else\ttfamily\fi%
  \ebnf@color{gray}{\relax\ifmmode\textsf{``}\else{\sffamily``}\fi}%
  #1%
  \ebnf@color{gray}{\relax\ifmmode\textsf{''}\else{\sffamily''}\fi}}}
\makeatother

\makeatletter
\newcommand\nonterminal[1]{%
  \ebnf@color{gray}{\relax\ifmmode\langle\else\(\langle\)\fi}%
  \relax\ifmmode\textsf{#1}\else{\sffamily#1}\fi%
  \ebnf@color{gray}{\relax\ifmmode\rangle\else\(\rangle\)\fi}}
\makeatother

\makeatletter
\newcommand\ebnf@optional[1]
  {\ebnf@color{gray}{[}#1\ebnf@color{gray}{]}}
\newcommand\ebnf@repetition[1]
  {\ebnf@color{gray}{\{}#1\ebnf@color{gray}{\}}}
\newcommand\ebnf@grouping[1]
  {\ebnf@color{gray}{(}#1\ebnf@color{gray}{)}}
\ExplSyntaxOn
\newcommand\ebnf@terminal[1]{
  \tl_set:Nn \l_ebnf_tl { }
  \tl_set_rescan:Nno \l_ebnf_tl { } { #1 }
  \terminal{\l_ebnf_tl}
}
\newcommand\ebnf@nonterminal[1]{
  \tl_set:Nn \l_ebnf_tl { }
  \tl_set_rescan:Nno \l_ebnf_tl { } { #1 }
  \nonterminal{\l_ebnf_tl}
}
\ExplSyntaxOff
\newcommand\ebnf@to
  {\ebnf@color{gray}{\(\to\)}}
\newcommand\ebnf@alternation
  {\ebnf@color{gray}{\(\vert\)}}
\makeatother

\ExplSyntaxOn
\cs_generate_variant:Nn \tl_replace_all:Nnn {Nx}
\makeatletter
\NewDocumentEnvironment{ebnf}{+b}
  {\tl_set:Nn\l__ebnf_tmp_tl{#1}}
  {\regex_replace_all:nnN { \{(.+?)\} }%
    {\c{ebnf@repetition}{\1}} \l__ebnf_tmp_tl%
  \regex_replace_all:nnN { \((.+?)\) }%
    {\c{ebnf@grouping}{\1}} \l__ebnf_tmp_tl%
  \regex_replace_all:nnN { \[(.+?)\] }%
    {\c{ebnf@optional}{\1}} \l__ebnf_tmp_tl%
  \regex_replace_all:nnN { <(.+?)> }%
    {\c{ebnf@nonterminal}{\1}} \l__ebnf_tmp_tl%
  \regex_replace_all:nnN { "(.+?)" }%
    {\c{ebnf@terminal}{\1}} \l__ebnf_tmp_tl%
  \regex_replace_all:nnN { \|\| }%
    {\c{-}\c{quad}\c{ebnf@alternation}{}} \l__ebnf_tmp_tl%
  \regex_replace_all:nnN { \| }%
    {\c{ebnf@alternation}{}} \l__ebnf_tmp_tl%
  \regex_replace_all:nnN { := }%
    {\c{ebnf@to}{}} \l__ebnf_tmp_tl%
  \ifdefined\ebnf@trail%
    \newwrite\ebnf@write%
    \immediate\openout\ebnf@write\ebnf@trail\relax%
    \immediate\write\ebnf@write{\unexpanded\expandafter{\l__ebnf_tmp_tl}}%
    \immediate\closeout\ebnf@write%
    \message{naive-ebnf:\space pre-processed\space TeX
      \space saved\space to\space "\ebnf@trail"^^J}%
  \fi%
  \l__ebnf_tmp_tl}
\makeatother
\ExplSyntaxOff

\endinput
%%
%% End of file `naive-ebnf.sty'.
